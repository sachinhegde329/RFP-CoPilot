rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /tenants/{tenantId} {
      // Allow anyone to read the public tenant info (for layout loading).
      allow read: if true;

      // Allow the 'megacorp' demo tenant to be created on the fly.
      // Disallow creation of any other tenant from the client.
      allow create: if tenantId == 'megacorp';

      // Disallow client-side updates and deletes to tenant documents.
      allow update, delete: if false;
    }

    // Secure all subcollections (RFPs, users, knowledge base, etc.)
    // Only allow authenticated users to access data within a tenant.
    match /tenants/{tenantId}/{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
