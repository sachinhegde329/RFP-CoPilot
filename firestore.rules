
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // PUBLIC: Allow anyone to read the top-level tenant document.
    match /tenants/{tenantId} {
      allow read: if true;
      
      // Allow creation of the 'megacorp' demo tenant on the fly.
      allow create: if tenantId == 'megacorp';
      
      // Deny direct writes to the tenant doc otherwise to protect it.
      allow update, delete: if false;

      // Subcollections (rfps, notifications, knowledge_base, etc.)
      match /{collection}/{docId=**} {
        // Allow public read ONLY for the 'megacorp' demo tenant's data.
        // For all other tenants, a user must be authenticated.
        allow read: if tenantId == 'megacorp' || request.auth != null;
        
        // Allow write only for authenticated users.
        // WARNING: This is still insecure as it doesn't check for tenant membership.
        // This should be replaced with a better data model (e.g., a memberIds array on the tenant).
        allow write: if request.auth != null;
      }
    }
  }
}
