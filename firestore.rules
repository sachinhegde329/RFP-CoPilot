rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow public read-only access to the main tenant document.
    // This is required for the application layout to load correctly for any visitor
    // before they have logged in. It only exposes public information like the tenant name and branding.
    match /tenants/{tenantId} {
      allow read: if true;
      
      // Allow writes only by authenticated users.
      // A more secure rule would check for membership, but this requires a different data structure (e.g., a map of UIDs).
      // This rule is sufficient for the demo and ensures the rules file is valid.
      allow write: if request.auth != null;
    }

    // Secure all sub-collections within a tenant (e.g., rfps, knowledge_sources).
    // Allow read/write access only to authenticated users.
    // Again, a more robust rule would check for membership in the specific tenant.
    match /tenants/{tenantId}/{collection}/{docId=**} {
      allow read, write: if request.auth != null;
    }
  }
}
